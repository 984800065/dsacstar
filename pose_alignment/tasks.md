你是一个计算机视觉与工程实现专家，请严格按照以下任务描述与约束完成工作。

====================
一、数据集结构说明
====================

我有两个数据集：

Dataset 1：
./pose_alignment/4dclip1

Dataset 2：
./pose_alignment/renders

两个数据集的目录结构完全一致，形式如下：

<dataset_root>/
 └── train/
     ├── calibration/
     ├── poses/
     └── rgb/

说明：
1. 所有需要处理的图像都在 train/rgb/ 目录下
2. calibration/ 与 poses/ 目录中包含与 rgb 中图像 **一一对应** 的文件
3. 图像文件名是关键索引：
   - rgb 中的图像名，与 calibration、poses 中的对应文件名（不含后缀）保持一致
4. 本任务只处理 train 部分，不涉及 test

====================
二、任务目标
====================

对 Dataset 1（4dclip1）中的 **每一张图像**，在 Dataset 2（renders）中：

- 最多匹配 **1 张** 图像
- 匹配依据为：
  - 拍摄场景相似
  - 拍摄视角 / 构图 / 几何结构尽可能相近
  - 不能只做语义相似（必须关注几何与视角）

最终输出：
- 匹配成功的图像对
- 对应的 calibration 与 pose 信息
- 每一对匹配的 **相似度分数**

====================
三、算法与技术要求
====================

【必须使用】
1. 图像特征提取：
   - 使用 DINOv2（Vision Transformer，自监督模型）
   - 提取全局特征向量
   - 对特征进行 L2 归一化

2. 相似度检索：
   - 使用 FAISS 进行向量相似度搜索
   - 使用余弦相似度（或等价的内积形式）

【匹配约束】
- 每张 Dataset 1 的图像：
  - 至多匹配 1 张 Dataset 2 的图像
- Dataset 2 中的同一张图像：
  - 不能被多个 Dataset 1 图像重复匹配
  - 一旦匹配成功，应从候选集中移除

====================
四、匹配分数与 Cut 机制
====================

1. 每一对匹配必须记录一个相似度分数（float）
2. 代码中必须保留一个可调节的阈值参数，例如：

    similarity_threshold = 0.0

3. 当前阶段：
   - threshold = 0.0
   - 即 Dataset 1 中的每张图像都应尝试匹配一张 Dataset 2 图像

4. 后续我会提高 threshold：
   - 当最高相似度 < threshold 时
   - 该 Dataset 1 图像 **不产生匹配结果**
   - 不进入最终输出

⚠️ 请在代码结构上明确支持这一 cut 逻辑，而不是写死

====================
五、结果输出目录结构
====================

所有匹配成功的结果，需要整理并复制到：

./pose_alignment/result/

该目录下应包含两个子目录：

./pose_alignment/result/sub_4dclip1/
./pose_alignment/result/sub_renders/

每个子目录的结构为：

sub_xxx/
 └── train/
     ├── calibration/
     ├── poses/
     └── rgb/

====================
六、结果编号与重排规则
====================

1. 只对【匹配成功的样本】进行保存
2. 在 result 中：
   - 文件名需要 **重新编号**
   - 编号从 0 开始递增（0, 1, 2, ...）
3. 对于每一对匹配：
   - sub_4dclip1 与 sub_renders 中的编号必须一致
   - rgb / calibration / poses 中对应编号一致

====================
七、代码放置与工程要求
====================

1. 请将 **所有实现代码放置在**：

    ./pose_alignment/

2. 代码应以一个或多个 Python 脚本形式存在，例如：
   - pose_alignment/match_images.py
   - pose_alignment/extract_features.py（如模块化）

3. 所有路径必须使用 **相对路径**
4. 不允许假设代码在其他工作目录中运行

====================
八、日志与进度显示要求（新增，强制）
====================

【进度条要求】
1. 所有涉及大量样本遍历的循环（例如：
   - 遍历 Dataset 1 图像
   - 提取特征
   - FAISS 查询）
   必须使用：

    from tqdm.auto import tqdm

2. 不允许使用裸 for-loop 无进度显示

【日志系统要求】
1. 必须使用 loguru 的 logger：

    from loguru import logger

2. logger 必须满足以下要求：
   - 输出日志到 **控制台**
   - 同时输出日志到 **文件**
   - 日志格式中必须包含：
     - 时间
     - 日志等级
     - 文件路径（file.path）
     - 行号（line）
     - 日志信息

   示例（不要求完全一致，但信息必须齐全）：
   [2025-xx-xx xx:xx:xx][INFO][pose_alignment/match_images.py:123] message

3. 至少记录以下关键事件：
   - 程序启动与参数（如 similarity_threshold）
   - DINOv2 模型加载完成
   - Dataset 1 / Dataset 2 图像数量
   - FAISS 索引构建完成
   - 每完成一定数量匹配的进度提示
   - 最终匹配成功的样本总数
   - 结果文件写入完成

4. logger 的配置应集中在代码初始化部分，方便后续调整

====================
九、实现要求
====================

请你完成以下内容：

1. 设计整体处理流程（pipeline）
2. 明确每一步的输入 / 输出
3. 使用 Python 实现完整流程，包括：
   - 目录遍历
   - 图像加载
   - DINOv2 特征提取
   - FAISS 索引构建
   - Top-1 匹配（含去重逻辑）
   - 相似度阈值 cut
   - 文件复制与重命名
4. 代码结构清晰，便于我后续修改 threshold 或替换模型
5. 在关键步骤处添加必要注释，说明设计意图

====================
十、重要注意事项
====================

- 不要使用 CLIP-only 方案
- 不要忽略视角 / 几何结构
- 不要假设两个数据集图片数量相同
- 不要覆盖原始数据
- 所有输出必须放在 pose_alignment/result 下

请确保代码是工程上可直接运行、可调试、可扩展的，而不是仅给出概念或零散片段。
